<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</title>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      background: #f4f6f9;
      margin: 20px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .cards {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .card {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 250px;
      text-align: center;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
      border: none;
    }
    button:hover {
      background: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: #fff;
    }
    td.status-active {
      color: green;
      font-weight: bold;
    }
    td.status-closed {
      color: red;
      font-weight: bold;
    }
    .actions {
      text-align: center;
      margin: 20px 0;
    }
    .actions button {
      width: auto;
      margin: 5px;
      padding: 10px 15px;
    }
  </style>
</head>
<body>

  <h2>ğŸ“‹ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h2>

  <div class="cards">
    <!-- Ø¨Ø·Ø§Ù‚Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ -->
    <div class="card">
      <h3>ğŸš— ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
      <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
      <select>
        <option>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</option>
        <option>ØªÙˆÙŠÙˆØªØ§ ÙÙˆØ±ØªØ´Ù†Ø±</option>
        <option>ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§</option>
        <option>Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡ Ø³ÙŠÙ„ÙØ±Ø§Ø¯Ùˆ</option>
        <option>Ù…Ø­Ø·Ø© Ø±ØµØ¯ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ 1</option>
        <option>Ù…Ø­Ø·Ø© Ø±ØµØ¯ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ 2</option>
        <option>ÙƒÙŠØ§ Ø±ÙŠÙˆ</option>
      </select>
      <button>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ -->
    <div class="card">
      <h3>ğŸ•’ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</h3>
      <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
      <select>
        <option>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</option>
        <option>ØªÙˆÙŠÙˆØªØ§ ÙÙˆØ±ØªØ´Ù†Ø±</option>
        <option>ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§</option>
        <option>Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡ Ø³ÙŠÙ„ÙØ±Ø§Ø¯Ùˆ</option>
        <option>Ù…Ø­Ø·Ø© Ø±ØµØ¯ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ 1</option>
        <option>Ù…Ø­Ø·Ø© Ø±ØµØ¯ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ 2</option>
        <option>ÙƒÙŠØ§ Ø±ÙŠÙˆ</option>
      </select>
      <button>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="actions">
    <button onclick="exportToCSV()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
    <button onclick="clearArchive()">ğŸ—‘ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
        <th>Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
        <th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
        <th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
        <th>Ø§Ù„Ù…Ø¯Ø©</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  let archive = [];

  if (localStorage.getItem('vehicleArchive')) {
    archive = JSON.parse(localStorage.getItem('vehicleArchive'));
    renderArchive();
  }

  function getCurrentDateTime() {
    const now = new Date();
    const date = now.toLocaleDateString('ar-EG');
    const time = now.toLocaleTimeString('ar-EG', { hour12: false });
    return { date, time, full: now };
  }

  function calculateDuration(start, end) {
    const diffMs = end - start;
    const diffMins = Math.floor(diffMs / 60000);
    const hours = Math.floor(diffMins / 60);
    const mins = diffMins % 60;
    return `${hours} Ø³ ${mins} Ø¯`;
  }

  function renderArchive() {
    const tbody = document.querySelector('table tbody');
    tbody.innerHTML = '';
    archive.forEach((record, index) => {
      const row = `<tr>
        <td>${index + 1}</td>
        <td>${record.date}</td>
        <td>${record.employee}</td>
        <td>${record.vehicle}</td>
        <td>${record.loginTime}</td>
        <td>${record.logoutTime || '-'}</td>
        <td>${record.duration || '-'}</td>
        <td class="${record.status === 'Ù†Ø´Ø·' ? 'status-active' : 'status-closed'}">${record.status}</td>
      </tr>`;
      tbody.innerHTML += row;
    });
  }

  function login(employeeInput, vehicleSelect) {
    const employee = employeeInput.value.trim();
    const vehicle = vehicleSelect.value;

    if (!employee || vehicle === 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©') {
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©.');
      return;
    }

    const existing = archive.find(rec => rec.employee === employee && rec.vehicle === vehicle && rec.status === 'Ù†Ø´Ø·');
    if (existing) {
      alert('Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©.');
      return;
    }

    const { date, time, full } = getCurrentDateTime();

    archive.push({
      date: date,
      employee: employee,
      vehicle: vehicle,
      loginTime: time,
      loginFull: full,
      logoutTime: '',
      logoutFull: null,
      duration: '',
      status: 'Ù†Ø´Ø·'
    });

    localStorage.setItem('vehicleArchive', JSON.stringify(archive));
    renderArchive();

    employeeInput.value = '';
    vehicleSelect.selectedIndex = 0;
  }

  function logout(employeeInput, vehicleSelect) {
    const employee = employeeInput.value.trim();
    const vehicle = vehicleSelect.value;

    if (!employee || vehicle === 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©') {
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©.');
      return;
    }

    for (let i = archive.length - 1; i >= 0; i--) {
      if (archive[i].employee === employee && archive[i].vehicle === vehicle && archive[i].status === 'Ù†Ø´Ø·') {
        const { time, full } = getCurrentDateTime();
        archive[i].logoutTime = time;
        archive[i].logoutFull = full;
        archive[i].status = 'Ù…ØºÙ„Ù‚';
        archive[i].duration = calculateDuration(new Date(archive[i].loginFull), full);

        localStorage.setItem('vehicleArchive', JSON.stringify(archive));
        renderArchive();

        employeeInput.value = '';
        vehicleSelect.selectedIndex = 0;
        return;
      }
    }
    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ù†Ø´Ø· Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„Ù…Ø±ÙƒØ¨Ø©.');
  }

  function exportToCSV() {
    if (archive.length === 0) {
      alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.');
      return;
    }
    let csv = "Ø±Ù‚Ù…,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù…ÙˆØ¸Ù,Ø§Ù„Ù…Ø±ÙƒØ¨Ø©,ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„,ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬,Ø§Ù„Ù…Ø¯Ø©,Ø§Ù„Ø­Ø§Ù„Ø©\n";
    archive.forEach((rec, i) => {
      csv += `${i + 1},${rec.date},${rec.employee},${rec.vehicle},${rec.loginTime},${rec.logoutTime || "-"},${rec.duration || "-"},${rec.status}\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "Ø³Ø¬Ù„_Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª.csv";
    link.click();
  }

  function clearArchive() {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ")) {
      archive = [];
      localStorage.removeItem('vehicleArchive');
      renderArchive();
    }
  }

  const loginCard = document.querySelectorAll('.cards .card')[0];
  const logoutCard = document.querySelectorAll('.cards .card')[1];

  loginCard.querySelector('button').onclick = () => {
    const employeeInput = loginCard.querySelector('input');
    const vehicleSelect = loginCard.querySelector('select');
    login(employeeInput, vehicleSelect);
  };

  logoutCard.querySelector('button').onclick = () => {
    const employeeInput = logoutCard.querySelector('input');
    const vehicleSelect = logoutCard.querySelector('select');
    logout(employeeInput, vehicleSelect);
  };
  </script>

</body>
</html>
